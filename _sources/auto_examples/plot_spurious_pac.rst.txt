

.. _sphx_glr_auto_examples_plot_spurious_pac.py:


Spurious PAC with spikes
------------------------

This example demonstrates how a spike train can generate a significant amount
of phase-amplitude coupling (PAC), even though there is no nested oscillations.
This phenomenon is usually referred as spurious PAC.

References
==========
Dupre la Tour et al. (2017). Non-linear Auto-Regressive Models for
Cross-Frequency Coupling in Neural Time Series. bioRxiv, 159731.



.. code-block:: python


    import numpy as np
    import matplotlib.pyplot as plt
    import scipy.signal

    from pactools import Comodulogram, REFERENCES
    from pactools.utils.pink_noise import pink_noise
    from pactools.utils.validation import check_random_state


    def simulate_spurious_pac(n_points, fs, spike_amp=1.5, spike_fwhm=0.01,
                              spike_fq=10., spike_interval_jitter=0.2,
                              random_state=None):
        """Simulate some spurious phase-amplitude coupling (PAC) with spikes

        References
        ----------
        Gerber, E. M., Sadeh, B., Ward, A., Knight, R. T., & Deouell, L. Y. (2016).
        Non-sinusoidal activity can produce cross-frequency coupling in cortical
        signals in the absence of functional interaction between neural sources.
        PloS one, 11(12), e0167351
        """
        n_points = int(n_points)
        fs = float(fs)
        rng = check_random_state(random_state)

        # draw the position of the spikes
        interval_min = 1. / float(spike_fq) * (1. - spike_interval_jitter)
        interval_max = 1. / float(spike_fq) * (1. + spike_interval_jitter)
        n_spikes_max = np.int(n_points / fs / interval_min)
        spike_intervals = rng.uniform(low=interval_min, high=interval_max,
                                      size=n_spikes_max)
        spike_positions = np.cumsum(np.int_(spike_intervals * fs))
        spike_positions = spike_positions[spike_positions < n_points]

        # build the spike time series, using a convolution
        spikes = np.zeros(n_points)
        spikes[spike_positions] = spike_amp
        # full width at half maximum to standard deviation convertion
        spike_std = spike_fwhm / (2 * np.sqrt(2 * np.log(2)))
        spike_shape = scipy.signal.gaussian(M=np.int(spike_std * fs * 10),
                                            std=spike_std * fs)
        spikes = scipy.signal.fftconvolve(spikes, spike_shape, mode='same')

        noise = pink_noise(n_points, slope=1.)

        return spikes + noise, spikes








Let's generate the spurious PAC signal



.. code-block:: python

    fs = 1000.  # Hz
    n_points = 60000
    spike_amp = 1.5
    random_state = 0

    # generate the signal
    signal, spikes = simulate_spurious_pac(
        n_points=n_points, fs=fs, random_state=random_state, spike_amp=spike_amp)

    # plot the signal and the spikes
    n_points_plot = np.int(1. * fs)
    time = np.arange(n_points_plot) / fs
    fig, axs = plt.subplots(nrows=2, figsize=(10, 6), sharex=True)
    axs[0].plot(time, signal[:n_points_plot], color='C0')
    axs[0].set(title='spikes + pink noise')
    axs[1].plot(time, spikes[:n_points_plot], color='C1')
    axs[1].set(xlabel='Time (sec)', title='spikes')
    plt.show()




.. image:: /auto_examples/images/sphx_glr_plot_spurious_pac_001.png
    :align: center




Compute the comodulograms



.. code-block:: python


    methods = ['ozkurt', 'penny', 'tort', 'duprelatour']
    low_fq_range = np.linspace(1., 20., 60)
    high_fq_range = np.linspace(low_fq_range[-1], 100., 60)
    low_fq_width = 4.  # Hz

    # A good rule of thumb is n_surrogates = 10 / p_value. Example: 10 / 0.05 = 200
    # Here we use 10 to be fast
    n_surrogates = 10
    p_value = 0.05
    n_jobs = 11

    # prepare the plot axes
    n_lines = 2
    n_columns = int(np.ceil(len(methods) / float(n_lines)))
    figsize = (4 * n_columns, 3 * n_lines)
    fig, axs = plt.subplots(nrows=n_lines, ncols=n_columns, figsize=figsize)
    axs = axs.ravel()

    for ax, method in zip(axs, methods):
        # compute the comodulograms
        estimator = Comodulogram(fs=fs, low_fq_range=low_fq_range,
                                 high_fq_range=high_fq_range,
                                 low_fq_width=low_fq_width, method=method,
                                 n_surrogates=n_surrogates, n_jobs=n_jobs)
        estimator.fit(signal)

        # plot the comodulogram with contour levels
        estimator.plot(contour_method='comod_max', contour_level=p_value, axs=[ax],
                       titles=[REFERENCES[method]])

    fig.tight_layout()
    plt.show()



.. image:: /auto_examples/images/sphx_glr_plot_spurious_pac_002.png
    :align: center


.. rst-class:: sphx-glr-script-out

 Out::

    [                                        ] 0% | 0.00 sec | comodulogram: ozkurt     [                                        ] 2% | 4.52 sec | comodulogram: ozkurt     [.                                       ] 3% | 4.87 sec | comodulogram: ozkurt     [..                                      ] 5% | 5.19 sec | comodulogram: ozkurt     [..                                      ] 7% | 5.51 sec | comodulogram: ozkurt     [...                                     ] 8% | 5.85 sec | comodulogram: ozkurt     [....                                    ] 10% | 6.16 sec | comodulogram: ozkurt     [....                                    ] 12% | 6.47 sec | comodulogram: ozkurt     [.....                                   ] 13% | 6.75 sec | comodulogram: ozkurt     [......                                  ] 15% | 7.12 sec | comodulogram: ozkurt     [......                                  ] 17% | 7.43 sec | comodulogram: ozkurt     [.......                                 ] 18% | 7.73 sec | comodulogram: ozkurt     [........                                ] 20% | 8.04 sec | comodulogram: ozkurt     [........                                ] 22% | 8.33 sec | comodulogram: ozkurt     [.........                               ] 23% | 8.61 sec | comodulogram: ozkurt     [..........                              ] 25% | 8.91 sec | comodulogram: ozkurt     [..........                              ] 27% | 9.20 sec | comodulogram: ozkurt     [...........                             ] 28% | 9.51 sec | comodulogram: ozkurt     [............                            ] 30% | 9.84 sec | comodulogram: ozkurt     [............                            ] 32% | 10.16 sec | comodulogram: ozkurt     [.............                           ] 33% | 10.47 sec | comodulogram: ozkurt     [..............                          ] 35% | 10.78 sec | comodulogram: ozkurt     [..............                          ] 37% | 11.12 sec | comodulogram: ozkurt     [...............                         ] 38% | 11.42 sec | comodulogram: ozkurt     [................                        ] 40% | 11.72 sec | comodulogram: ozkurt     [................                        ] 42% | 11.97 sec | comodulogram: ozkurt     [.................                       ] 43% | 12.25 sec | comodulogram: ozkurt     [..................                      ] 45% | 12.55 sec | comodulogram: ozkurt     [..................                      ] 47% | 12.83 sec | comodulogram: ozkurt     [...................                     ] 48% | 13.13 sec | comodulogram: ozkurt     [....................                    ] 50% | 13.45 sec | comodulogram: ozkurt     [....................                    ] 52% | 13.78 sec | comodulogram: ozkurt     [.....................                   ] 53% | 14.06 sec | comodulogram: ozkurt     [......................                  ] 55% | 14.38 sec | comodulogram: ozkurt     [......................                  ] 57% | 14.65 sec | comodulogram: ozkurt     [.......................                 ] 58% | 14.91 sec | comodulogram: ozkurt     [........................                ] 60% | 15.18 sec | comodulogram: ozkurt     [........................                ] 62% | 15.44 sec | comodulogram: ozkurt     [.........................               ] 63% | 15.78 sec | comodulogram: ozkurt     [..........................              ] 65% | 16.08 sec | comodulogram: ozkurt     [..........................              ] 67% | 16.36 sec | comodulogram: ozkurt     [...........................             ] 68% | 16.66 sec | comodulogram: ozkurt     [............................            ] 70% | 16.99 sec | comodulogram: ozkurt     [............................            ] 72% | 17.30 sec | comodulogram: ozkurt     [.............................           ] 73% | 17.57 sec | comodulogram: ozkurt     [..............................          ] 75% | 17.87 sec | comodulogram: ozkurt     [..............................          ] 77% | 18.14 sec | comodulogram: ozkurt     [...............................         ] 78% | 18.41 sec | comodulogram: ozkurt     [................................        ] 80% | 18.69 sec | comodulogram: ozkurt     [................................        ] 82% | 19.02 sec | comodulogram: ozkurt     [.................................       ] 83% | 19.32 sec | comodulogram: ozkurt     [..................................      ] 85% | 19.66 sec | comodulogram: ozkurt     [..................................      ] 87% | 19.95 sec | comodulogram: ozkurt     [...................................     ] 88% | 20.28 sec | comodulogram: ozkurt     [....................................    ] 90% | 20.59 sec | comodulogram: ozkurt     [....................................    ] 92% | 20.85 sec | comodulogram: ozkurt     [.....................................   ] 93% | 21.17 sec | comodulogram: ozkurt     [......................................  ] 95% | 21.49 sec | comodulogram: ozkurt     [......................................  ] 97% | 21.85 sec | comodulogram: ozkurt     [....................................... ] 98% | 22.11 sec | comodulogram: ozkurt     [........................................] 100% | 22.43 sec | comodulogram: ozkurt 
    [                                        ] 0% | 0.00 sec | comodulogram: penny     [                                        ] 2% | 3.60 sec | comodulogram: penny     [.                                       ] 3% | 7.19 sec | comodulogram: penny     [..                                      ] 5% | 9.96 sec | comodulogram: penny     [..                                      ] 7% | 12.51 sec | comodulogram: penny     [...                                     ] 8% | 15.26 sec | comodulogram: penny     [....                                    ] 10% | 18.28 sec | comodulogram: penny     [....                                    ] 12% | 22.04 sec | comodulogram: penny     [.....                                   ] 13% | 24.41 sec | comodulogram: penny     [......                                  ] 15% | 27.59 sec | comodulogram: penny     [......                                  ] 17% | 29.64 sec | comodulogram: penny     [.......                                 ] 18% | 31.21 sec | comodulogram: penny     [........                                ] 20% | 33.50 sec | comodulogram: penny     [........                                ] 22% | 35.98 sec | comodulogram: penny     [.........                               ] 23% | 38.00 sec | comodulogram: penny     [..........                              ] 25% | 39.71 sec | comodulogram: penny     [..........                              ] 27% | 41.28 sec | comodulogram: penny     [...........                             ] 28% | 43.26 sec | comodulogram: penny     [............                            ] 30% | 45.65 sec | comodulogram: penny     [............                            ] 32% | 47.94 sec | comodulogram: penny     [.............                           ] 33% | 50.34 sec | comodulogram: penny     [..............                          ] 35% | 53.11 sec | comodulogram: penny     [..............                          ] 37% | 55.53 sec | comodulogram: penny     [...............                         ] 38% | 58.39 sec | comodulogram: penny     [................                        ] 40% | 60.09 sec | comodulogram: penny     [................                        ] 42% | 62.33 sec | comodulogram: penny     [.................                       ] 43% | 64.48 sec | comodulogram: penny     [..................                      ] 45% | 66.72 sec | comodulogram: penny     [..................                      ] 47% | 68.81 sec | comodulogram: penny     [...................                     ] 48% | 70.95 sec | comodulogram: penny     [....................                    ] 50% | 73.58 sec | comodulogram: penny     [....................                    ] 52% | 75.47 sec | comodulogram: penny     [.....................                   ] 53% | 77.45 sec | comodulogram: penny     [......................                  ] 55% | 80.03 sec | comodulogram: penny     [......................                  ] 57% | 82.57 sec | comodulogram: penny     [.......................                 ] 58% | 84.52 sec | comodulogram: penny     [........................                ] 60% | 87.15 sec | comodulogram: penny     [........................                ] 62% | 89.74 sec | comodulogram: penny     [.........................               ] 63% | 92.02 sec | comodulogram: penny     [..........................              ] 65% | 93.95 sec | comodulogram: penny     [..........................              ] 67% | 96.17 sec | comodulogram: penny     [...........................             ] 68% | 98.55 sec | comodulogram: penny     [............................            ] 70% | 100.71 sec | comodulogram: penny     [............................            ] 72% | 102.77 sec | comodulogram: penny     [.............................           ] 73% | 105.26 sec | comodulogram: penny     [..............................          ] 75% | 107.95 sec | comodulogram: penny     [..............................          ] 77% | 110.09 sec | comodulogram: penny     [...............................         ] 78% | 112.55 sec | comodulogram: penny     [................................        ] 80% | 114.39 sec | comodulogram: penny     [................................        ] 82% | 116.63 sec | comodulogram: penny     [.................................       ] 83% | 118.97 sec | comodulogram: penny     [..................................      ] 85% | 121.07 sec | comodulogram: penny     [..................................      ] 87% | 123.59 sec | comodulogram: penny     [...................................     ] 88% | 125.92 sec | comodulogram: penny     [....................................    ] 90% | 128.53 sec | comodulogram: penny     [....................................    ] 92% | 130.82 sec | comodulogram: penny     [.....................................   ] 93% | 133.27 sec | comodulogram: penny     [......................................  ] 95% | 135.32 sec | comodulogram: penny     [......................................  ] 97% | 138.50 sec | comodulogram: penny     [....................................... ] 98% | 141.01 sec | comodulogram: penny     [........................................] 100% | 142.97 sec | comodulogram: penny 
    [                                        ] 0% | 0.00 sec | comodulogram: tort     [                                        ] 2% | 2.29 sec | comodulogram: tort     [.                                       ] 3% | 2.74 sec | comodulogram: tort     [..                                      ] 5% | 3.18 sec | comodulogram: tort     [..                                      ] 7% | 3.70 sec | comodulogram: tort     [...                                     ] 8% | 4.13 sec | comodulogram: tort     [....                                    ] 10% | 4.58 sec | comodulogram: tort     [....                                    ] 12% | 5.05 sec | comodulogram: tort     [.....                                   ] 13% | 5.59 sec | comodulogram: tort     [......                                  ] 15% | 6.06 sec | comodulogram: tort     [......                                  ] 17% | 6.59 sec | comodulogram: tort     [.......                                 ] 18% | 7.02 sec | comodulogram: tort     [........                                ] 20% | 7.47 sec | comodulogram: tort     [........                                ] 22% | 7.94 sec | comodulogram: tort     [.........                               ] 23% | 8.41 sec | comodulogram: tort     [..........                              ] 25% | 8.95 sec | comodulogram: tort     [..........                              ] 27% | 9.48 sec | comodulogram: tort     [...........                             ] 28% | 10.02 sec | comodulogram: tort     [............                            ] 30% | 10.53 sec | comodulogram: tort     [............                            ] 32% | 11.08 sec | comodulogram: tort     [.............                           ] 33% | 11.56 sec | comodulogram: tort     [..............                          ] 35% | 12.00 sec | comodulogram: tort     [..............                          ] 37% | 12.47 sec | comodulogram: tort     [...............                         ] 38% | 12.92 sec | comodulogram: tort     [................                        ] 40% | 13.36 sec | comodulogram: tort     [................                        ] 42% | 13.84 sec | comodulogram: tort     [.................                       ] 43% | 14.31 sec | comodulogram: tort     [..................                      ] 45% | 14.80 sec | comodulogram: tort     [..................                      ] 47% | 15.25 sec | comodulogram: tort     [...................                     ] 48% | 15.72 sec | comodulogram: tort     [....................                    ] 50% | 16.18 sec | comodulogram: tort     [....................                    ] 52% | 16.64 sec | comodulogram: tort     [.....................                   ] 53% | 17.16 sec | comodulogram: tort     [......................                  ] 55% | 17.69 sec | comodulogram: tort     [......................                  ] 57% | 18.14 sec | comodulogram: tort     [.......................                 ] 58% | 18.66 sec | comodulogram: tort     [........................                ] 60% | 19.10 sec | comodulogram: tort     [........................                ] 62% | 19.64 sec | comodulogram: tort     [.........................               ] 63% | 20.09 sec | comodulogram: tort     [..........................              ] 65% | 20.66 sec | comodulogram: tort     [..........................              ] 67% | 21.20 sec | comodulogram: tort     [...........................             ] 68% | 21.67 sec | comodulogram: tort     [............................            ] 70% | 22.21 sec | comodulogram: tort     [............................            ] 72% | 22.70 sec | comodulogram: tort     [.............................           ] 73% | 23.25 sec | comodulogram: tort     [..............................          ] 75% | 23.78 sec | comodulogram: tort     [..............................          ] 77% | 24.27 sec | comodulogram: tort     [...............................         ] 78% | 24.83 sec | comodulogram: tort     [................................        ] 80% | 25.34 sec | comodulogram: tort     [................................        ] 82% | 25.88 sec | comodulogram: tort     [.................................       ] 83% | 26.37 sec | comodulogram: tort     [..................................      ] 85% | 26.88 sec | comodulogram: tort     [..................................      ] 87% | 27.34 sec | comodulogram: tort     [...................................     ] 88% | 27.81 sec | comodulogram: tort     [....................................    ] 90% | 28.26 sec | comodulogram: tort     [....................................    ] 92% | 28.76 sec | comodulogram: tort     [.....................................   ] 93% | 29.36 sec | comodulogram: tort     [......................................  ] 95% | 29.90 sec | comodulogram: tort     [......................................  ] 97% | 30.47 sec | comodulogram: tort     [....................................... ] 98% | 30.94 sec | comodulogram: tort     [........................................] 100% | 31.50 sec | comodulogram: tort 
    [                                        ] 0% | 0.00 sec | comodulogram: DAR(10, 1)     [                                        ] 2% | 0.12 sec | comodulogram: DAR(10, 1)     [.                                       ] 3% | 0.14 sec | comodulogram: DAR(10, 1)     [..                                      ] 5% | 0.17 sec | comodulogram: DAR(10, 1)     [..                                      ] 7% | 0.19 sec | comodulogram: DAR(10, 1)     [...                                     ] 8% | 0.22 sec | comodulogram: DAR(10, 1)     [....                                    ] 10% | 0.24 sec | comodulogram: DAR(10, 1)     [....                                    ] 12% | 0.29 sec | comodulogram: DAR(10, 1)     [.....                                   ] 13% | 0.51 sec | comodulogram: DAR(10, 1)     [......                                  ] 15% | 0.67 sec | comodulogram: DAR(10, 1)     [......                                  ] 17% | 0.76 sec | comodulogram: DAR(10, 1)     [.......                                 ] 18% | 0.86 sec | comodulogram: DAR(10, 1)     [........                                ] 20% | 0.92 sec | comodulogram: DAR(10, 1)     [........                                ] 22% | 1.05 sec | comodulogram: DAR(10, 1)     [.........                               ] 23% | 1.18 sec | comodulogram: DAR(10, 1)     [..........                              ] 25% | 1.29 sec | comodulogram: DAR(10, 1)     [..........                              ] 27% | 1.35 sec | comodulogram: DAR(10, 1)     [...........                             ] 28% | 1.39 sec | comodulogram: DAR(10, 1)     [............                            ] 30% | 1.45 sec | comodulogram: DAR(10, 1)     [............                            ] 32% | 1.60 sec | comodulogram: DAR(10, 1)     [.............                           ] 33% | 1.71 sec | comodulogram: DAR(10, 1)     [..............                          ] 35% | 1.82 sec | comodulogram: DAR(10, 1)     [..............                          ] 37% | 2.84 sec | comodulogram: DAR(10, 1)     [...............                         ] 38% | 3.73 sec | comodulogram: DAR(10, 1)     [................                        ] 40% | 5.54 sec | comodulogram: DAR(10, 1)     [................                        ] 42% | 5.75 sec | comodulogram: DAR(10, 1)     [.................                       ] 43% | 5.89 sec | comodulogram: DAR(10, 1)     [..................                      ] 45% | 6.04 sec | comodulogram: DAR(10, 1)     [..................                      ] 47% | 6.08 sec | comodulogram: DAR(10, 1)     [...................                     ] 48% | 6.32 sec | comodulogram: DAR(10, 1)     [....................                    ] 50% | 6.64 sec | comodulogram: DAR(10, 1)     [....................                    ] 52% | 6.98 sec | comodulogram: DAR(10, 1)     [.....................                   ] 53% | 7.15 sec | comodulogram: DAR(10, 1)     [......................                  ] 55% | 7.33 sec | comodulogram: DAR(10, 1)     [......................                  ] 57% | 7.72 sec | comodulogram: DAR(10, 1)     [.......................                 ] 58% | 8.00 sec | comodulogram: DAR(10, 1)     [........................                ] 60% | 8.19 sec | comodulogram: DAR(10, 1)     [........................                ] 62% | 9.12 sec | comodulogram: DAR(10, 1)     [.........................               ] 63% | 9.46 sec | comodulogram: DAR(10, 1)     [..........................              ] 65% | 10.45 sec | comodulogram: DAR(10, 1)     [..........................              ] 67% | 10.98 sec | comodulogram: DAR(10, 1)     [...........................             ] 68% | 11.11 sec | comodulogram: DAR(10, 1)     [............................            ] 70% | 11.57 sec | comodulogram: DAR(10, 1)     [............................            ] 72% | 12.58 sec | comodulogram: DAR(10, 1)     [.............................           ] 73% | 12.73 sec | comodulogram: DAR(10, 1)     [..............................          ] 75% | 12.98 sec | comodulogram: DAR(10, 1)     [..............................          ] 77% | 13.21 sec | comodulogram: DAR(10, 1)     [...............................         ] 78% | 13.53 sec | comodulogram: DAR(10, 1)     [................................        ] 80% | 13.65 sec | comodulogram: DAR(10, 1)     [................................        ] 82% | 13.75 sec | comodulogram: DAR(10, 1)     [.................................       ] 83% | 14.10 sec | comodulogram: DAR(10, 1)     [..................................      ] 85% | 14.17 sec | comodulogram: DAR(10, 1)     [..................................      ] 87% | 14.29 sec | comodulogram: DAR(10, 1)     [...................................     ] 88% | 14.43 sec | comodulogram: DAR(10, 1)     [....................................    ] 90% | 15.73 sec | comodulogram: DAR(10, 1)     [....................................    ] 92% | 15.83 sec | comodulogram: DAR(10, 1)     [.....................................   ] 93% | 16.30 sec | comodulogram: DAR(10, 1)     [......................................  ] 95% | 16.63 sec | comodulogram: DAR(10, 1)     [......................................  ] 97% | 17.26 sec | comodulogram: DAR(10, 1)     [....................................... ] 98% | 18.10 sec | comodulogram: DAR(10, 1)     [........................................] 100% | 18.55 sec | comodulogram: DAR(10, 1) 
    [........................................] 100% | 24.76 sec | comodulogram: DAR(10, 1)


**Total running time of the script:** ( 3 minutes  43.481 seconds)



.. container:: sphx-glr-footer


  .. container:: sphx-glr-download

     :download:`Download Python source code: plot_spurious_pac.py <plot_spurious_pac.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: plot_spurious_pac.ipynb <plot_spurious_pac.ipynb>`

.. rst-class:: sphx-glr-signature

    `Generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
